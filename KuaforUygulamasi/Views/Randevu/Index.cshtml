@model IEnumerable<KuaforUygulamasi.Models.Randevu>

@using System.Security.Claims  <!-- Burada ClaimTypes'ı kullanabilmek için ekliyoruz -->

<div class="container mt-4">
    <h2>Randevu Listesi</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            @TempData["ErrorMessage"]
        </div>
    }

    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Randevu Tarihi</th>
                <th>Çalışan</th>
                <th>İşlem</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var randevu in Model)
            {
                <tr>
                    <td>@randevu.ID</td>
                    <td>@randevu.Saat.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</td>
                    <td>@randevu.Calisan.Ad @randevu.Calisan.Soyad</td>
                    <td>@randevu.Islem.Ad</td>
                    <td>
                        <!-- Detaylar -->
                        <a href="@Url.Action("Details", "Randevu", new { id = randevu.ID })" class="btn btn-info">Detay</a>

                        <!-- Silme işlemi sadece kullanıcıya ait randevular için yapılabilir -->
                        @if (randevu.KullaniciId == User.FindFirstValue(ClaimTypes.NameIdentifier) || User.IsInRole("Admin"))
                        {
                            <form action="@Url.Action("Delete", "Randevu", new { id = randevu.ID })" method="post" style="display:inline;">
                                @Html.AntiForgeryToken() <!-- Anti-forgery token ekliyoruz -->
                                <button type="submit" class="btn btn-danger">Sil</button>
                            </form>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
